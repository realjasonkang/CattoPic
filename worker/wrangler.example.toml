# CattoPic Worker Configuration Template
# Copy this file to wrangler.toml and fill in your values
# cp wrangler.example.toml wrangler.toml

name = 'cattopic-worker'
main = 'src/index.ts'
compatibility_date = '2025-12-10'
compatibility_flags = ['nodejs_compat']

[vars]
ENVIRONMENT = 'production'
# Your R2 bucket public URL (custom domain or workers.dev URL)
R2_PUBLIC_URL = '<your-r2-public-url>'
# Set to 'true' to enable Cloudflare Queues for async R2 deletion
# Set to 'false' or remove to use synchronous deletion (no Queue required)
USE_QUEUE = 'false'

# Images binding for image transformations (Cloudflare Images)
[images]
binding = "IMAGES"

# R2 Bucket binding
[[r2_buckets]]
binding = 'R2_BUCKET'
# Your R2 bucket name
bucket_name = '<your-r2-bucket-name>'

# D1 Database binding
[[d1_databases]]
binding = 'DB'
# Your D1 database name
database_name = '<your-d1-database-name>'
# Your D1 database ID (get from: wrangler d1 list)
database_id = '<your-d1-database-id>'

# KV Namespace for caching
[[kv_namespaces]]
binding = "CACHE_KV"
# Your KV namespace ID (get from: wrangler kv namespace list)
id = "<your-kv-namespace-id>"

# (Optional) Queue for async R2 deletion - only needed if USE_QUEUE = 'true'
# Requires Cloudflare Workers Paid plan
# [[queues.producers]]
# queue = "<your-queue-name>"
# binding = "DELETE_QUEUE"
#
# [[queues.consumers]]
# queue = "<your-queue-name>"
# max_batch_size = 10
# max_batch_timeout = 5

# Cron Triggers - cleanup expired images every hour
[triggers]
crons = ['0 * * * *']

# Development settings
[dev]
port = 8787
local_protocol = 'http'

# Observability - logging configuration
[observability]
[observability.logs]
enabled = true
head_sampling_rate = 1
invocation_logs = true
persist = true
